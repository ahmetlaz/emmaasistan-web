<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Emma - SÃ¼per AkÄ±llÄ± Kod AsistanÄ±</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: Arial; background: #f9f9fc; margin:0; }
    #chat { height: 280px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;}
    #input { width: 60%; }
    #emma-controls button,#emma-controls select,#emma-controls input[type=file] { margin: 5px 3px 5px 0; }
    #image-result { margin-top: 10px; }
    .emma { color: #2b5db3; margin-bottom:8px; }
    .user { color: #2e7d3b; margin-bottom:8px; }
    pre { background: #f8f8f8; padding: 10px; }
    #memory { margin-top: 10px; border: 1px dashed #aaa; padding: 5px; max-height:180px; overflow-y:auto;}
    #extra { margin-top: 15px; }
    @media (max-width:600px){
      #input { width: 90%; }
      #chat { height: 200px; }
    }
  </style>
</head>
<body>
  <div id="chat"></div>
  <div id="emma-controls">
    <input id="input" placeholder="Emma'ya bir ÅŸey sor..." autocomplete="off">
    <button id="send">GÃ¶nder</button>
    <button id="mic">ðŸŽ¤</button>
    <input type="file" id="upload" multiple>
    <button id="download">Ã‡Ä±ktÄ± Ä°ndir</button>
    <button id="generate-image">GÃ¶rsel OluÅŸtur</button>
    <select id="lang">
      <option value="tr-TR">TÃ¼rkÃ§e</option>
      <option value="en-US">English</option>
      <option value="de-DE">Deutsch</option>
      <option value="ar-SA">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    </select>
    <button id="profile">Profil</button>
    <button id="calendar">Takvim</button>
    <button id="exportPDF">PDF</button>
    <button id="exportMD">Markdown</button>
    <button id="backupCloud">Buluta Yedekle</button>
    <button id="githubSync">Github Sync</button>
    <button id="motivation">Motivasyon</button>
    <select id="theme">
      <option value="light">AÃ§Ä±k Tema</option>
      <option value="dark">Koyu Tema</option>
    </select>
  </div>
  <div id="image-result"></div>
  <div id="memory"></div>
  <div id="extra"></div>
  <script src="emma-memory.js"></script>
  <script src="emma-openai.js"></script>
  <!-- Firestore ve sesli konuÅŸma kodu -->
  <script type="module">
    try {
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyD9OW6XmYf8Fir6lUitBKgIN2Q3OCVJ5y8",
        authDomain: "emma-57d1a.firebaseapp.com",
        projectId: "emma-57d1a",
        storageBucket: "emma-57d1a.appspot.com",
        messagingSenderId: "315917575340",
        appId: "1:315917575340:web:7b7d6ad4fe79c0a70deb09",
        measurementId: "G-TDPCNFP473"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Mesaj ekle
      async function saveMessage(message, sender) {
        await addDoc(collection(db, "messages"), {
          message,
          sender,
          timestamp: Date.now()
        });
      }

      // MesajlarÄ± Ã§ek
      async function getMessages() {
        const querySnapshot = await getDocs(collection(db, "messages"));
        let messages = [];
        querySnapshot.forEach((doc) => {
          messages.push(doc.data());
        });
        messages.sort((a,b)=>a.timestamp-b.timestamp);
        return messages;
      }

      // Chat gÃ¼ncelle
      async function showMessages() {
        const chatArea = document.getElementById("chat");
        chatArea.innerHTML = "";
        const messages = await getMessages();
        messages.forEach(msg => {
          const div = document.createElement("div");
          div.className = msg.sender === "Emma" ? "emma" : "user";
          div.textContent = `${msg.sender}: ${msg.message}`;
          chatArea.appendChild(div);
        });
        chatArea.scrollTop = chatArea.scrollHeight;
      }

      // GÃ–NDER butonu fonksiyonu
      document.getElementById("send").onclick = async () => {
        try {
          const userInput = document.getElementById("input");
          const text = userInput.value.trim();
          if (!text) return;
          await saveMessage(text, "Sen");
          await saveMessage("MesajÄ±nÄ± aldÄ±m! :)", "Emma");
          userInput.value = "";
          await showMessages();
        } catch (err) {
          alert("Mesaj gÃ¶nderirken hata oluÅŸtu: " + err.message);
        }
      };

      // Enter tuÅŸu ile de gÃ¶nder
      document.getElementById("input").addEventListener("keydown", function(e){
        if(e.key === "Enter"){
          document.getElementById("send").click();
        }
      });

      // Mikrofon - sesli yazma Ã¶zelliÄŸi
      document.getElementById("mic").onclick = () => {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if(!SpeechRecognition){
          alert("TarayÄ±cÄ±nÄ±z sesli konuÅŸmayÄ± desteklemiyor!");
          return;
        }
        const recognition = new SpeechRecognition();
        recognition.lang = "tr-TR";
        recognition.start();
        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          document.getElementById("input").value = transcript;
          // Otomatik gÃ¶nder istersen:
          // document.getElementById("send").click();
        };
      };

      window.onload = showMessages;
    } catch (err) {
      alert("Kodlarda genel bir hata var: " + err.message);
    }
  </script>
</body>
</html>